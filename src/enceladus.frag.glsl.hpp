static const char *g_shader_fragment_enceladus = ""
#if defined(USE_LD)
"enceladus.frag.glsl"
#else
"layout(location=0)uniform vec3 s[5];"
"layout(location=5)uniform sampler2D J;"
"layout(location=6)uniform sampler2D U;"
"layout(location=7)uniform sampler2D k;"
"layout(location=8)uniform sampler3D w;"
"layout(location=11)uniform sampler2D I;"
"vec3 d=normalize(vec3(.26,.4,.87)),u=normalize(vec3(-.1,.9,.4));"
"float z=9,T=1,h=7400,P=14050,Y=5823;"
"in vec3 f;"
"out vec4 o;"
"vec3 q()"
"{"
"return normalize(vec3(.8,.1,-.1))*23795.;"
"}"
"float b(vec3 e)"
"{"
"return c(e,q(),Y);"
"}"
"float m(vec3 e)"
"{"
"float t=G(e,q(),u,9.),o=g(e,q(),h,P);"
"return max(t,o);"
"}"
"float H(vec2 e)"
"{"
"mat2 t=mat2(.79,-.69,.6,.81);"
"e=t*e;"
"vec2 o=vec2(.001);"
"float l=2.69,f=-.39,c=1,v=0;"
"for(int a=0;"
"a<4;"
"++a)v+=textureGrad(k,e,o,o).s*c,c*=f,e=t*e*l;"
"return v;"
"}"
"float v0(float e)"
"{"
"float t=.25,c=20,o=.5+tanh(c*(e-t))*.5,v=pow(3.*e,2.)-1.,a=.25*(sin((e-t)*(3.14159/(1.-t))+(3.141593)*.5)+1.);"
"return o*a+(1.-o)*v;"
"}"
"float n(vec3 e)"
"{"
"float v=F(e,vec3(0),vec3(.0,1.,.0)),t=500,a=t*.5;"
"if(v<t*.5)"
"{"
"float c=0,o=min(length(e.sp*.00011),length((e.sp+vec2(-100.,27500.))*.00006));"
"if(o<1.)c=v0(o)*1.4;"
"float v=(textureGrad(I,e.sp*.00003+vec2(-.1,-.1),vec2(0),vec2(.0)).s-1.)*1.3,l=H(e.sp*vec2(.0000041,.0000061)+vec2(.1))/max(pow(abs(c)*17.,.61),2.)*(1.-smoothstep(.3,.9,o)*.55+smoothstep(.9,2.7,o)*.5)*(1.+abs(v)*1.1);"
"a=(c+l+v)*t-t;"
"}"
"return v-a;"
"}"
"vec3 A()"
"{"
"return vec3(7000,-5000.,6000.)+smoothstep(19500.,24000.,s[4].s)*vec3(2000,.0,-2000.)+smoothstep(16000.,19000.,s[4].s)*vec3(.0,4500.,.0);"
"}"
"float L(vec3 l)"
"{"
"vec3 e=l-A()-vec3(0,-33333.,.0);"
"float o=length(e);"
"e/=o;"
"float v=dot(e,vec3(.0,1.,.0))*1.33,c=dot(e,d)*1.33,f=dot(e,u)*1.33,t=s[4].s,a=i(w,vec3(-v-t*.000015,o*.0000014,c+t*.00001))+i(w,vec3(-c+t*.000011,o*.0000016,f)),n=i(w,vec3(-v-t*.0002,o*.000011,c+t*.000008));"
"return pow(abs(smoothstep(.3,1.6,a)-smoothstep(-.3,.9,-a))+.1,2.)+n*.5;"
"}"
"float K()"
"{"
"return 7000.*(1.+smoothstep(22000,25000,s[4].s)*.9);"
"}"
"float X(vec3 e)"
"{"
"return max(.0,K()-length(e*vec3(1.,.2,1.)-A()))/K()*smoothstep(13500.,17000.,s[4].s);"
"}"
"float N(vec3 e)"
"{"
"return F(e,A(),vec3(-.64,.0,-.9));"
"}"
"vec3 Q(vec3 t,vec3 o)"
"{"
"vec3 e=mix(t,o,.2);"
"for(int c=0;"
"c<11;"
"++c)"
"{"
"float v=b(e);"
"if(v<.0)o=e;"
"else t=e;"
"e=(t+o)*.5;"
"}"
"return e;"
"}"
"vec3 y(vec3 t,vec3 o)"
"{"
"vec3 e=mix(t,o,.2);"
"for(int c=0;"
"c<11;"
"++c)"
"{"
"float v=m(e);"
"if(v<.0)o=e;"
"else t=e;"
"e=(t+o)*.5;"
"}"
"return e;"
"}"
"vec3 R(vec3 t,vec3 o)"
"{"
"vec3 e=mix(t,o,.2);"
"for(int c=0;"
"c<11;"
"++c)"
"{"
"float v=n(e);"
"if(v<.0)o=e;"
"else t=e;"
"e=(t+o)*.5;"
"}"
"return e;"
"}"
"vec3 M(vec3 t,vec3 o)"
"{"
"vec3 e=mix(t,o,.2);"
"for(int c=0;"
"c<11;"
"++c)"
"{"
"float v=N(e);"
"if(v<.0)o=e;"
"else t=e;"
"e=(t+o)*.5;"
"}"
"return e;"
"}"
"float S(vec3 e)"
"{"
"vec3 v;"
"float t=0;"
"bool a=false;"
"for(int o=0;"
"o<77;"
"++o)"
"{"
"float c=b(e),l=c;"
"if(o>0)"
"{"
"if(c<.0)return 1;"
"if(!a)"
"{"
"float o=m(e);"
"l=min(o,c);"
"if(o<.0)"
"{"
"vec3 o=y(v,e);"
"float e=(1.-abs(dot(d,u)))/222.+length(o-s[0])/777777.;"
"t=max(textureGrad(U,vec2((length(o)-h)/(P-h),.0),vec2(e),vec2(e)).q,t),a=true;"
"}"
"}"
"}"
"v=e,e+=d*(abs(l)+z*T);"
"}"
"return t;"
"}"
"float U0(vec3 e)"
"{"
"vec3 v;"
"float o=0;"
"bool a=false;"
"for(int c=0;"
"c<77;"
"++c)"
"{"
"float t=9999;"
"if(e.t<-100.)t=n(e);"
"float l=t;"
"if(c>0)if(t<.0)"
"{"
"o-=t*.2;"
"if(o>=1.)return 1;"
"}"
"if(!a)"
"{"
"float c=N(e);"
"l=min(c,t);"
"if(c<.0)"
"{"
"e=M(e,v);"
"float t=X(e);"
"if(t>.0)o+=L(e)*sqrt(t);"
"a=true;"
"}"
"}"
"v=e,e+=d*(abs(l)+z*T);"
"}"
"return o;"
"}"
"void main()"
"{"
"vec3 v=normalize(f),e=s[0],a=e;"
"float D=0,l=0;"
"vec4 t=vec4(0),c=vec4(0);"
"bool r=false,p=false;"
"float g=25000,w=19000,A=5000;"
"for(int u=0;"
"u<140;"
"++u)"
"{"
"if(l>=g)break;"
"float o=9999;"
"if(e.t<-100.||v.t<=.0)o=n(e);"
"float m=N(e),f=o;"
"if(o<.0)"
"{"
"e=R(a,e);"
"vec2 o=vec2(27.*(1.+smoothstep(.0,g,length(s[0]-e))*3.),.0);"
"vec3 v=normalize(vec3(n(e+o.stt),n(e+o.tst),n(e+o.tts))-n(e));"
"float c=smoothstep(-.3,1.,dot(v,d))*(1.4+i(k,e.sp*.00001)*1.4);"
"t=vec4(c,c,c,1.);"
"break;"
"}"
"else if(!r)"
"{"
"f=min(m,o);"
"if(m<.0)"
"{"
"e=M(a,e);"
"float t=X(e);"
"if(t>.0)c=vec4(L(e)*t)*vec4(.93,.93,1.,1.);"
"r=true;"
"}"
"}"
"a=e,D=f;"
"float a=abs(f)+z;"
"l+=a,e+=v*a;"
"}"
"if(t.q<=.0)"
"{"
"vec3 e=vec3(0),o=e;"
"float f=0;"
"for(int n=0;"
"n<166;"
"++n)"
"{"
"float a=b(e),l=a;"
"if(a<.0)"
"{"
"o=x(e,o,v,f,Y),e=Q(o,e);"
"mat2 a=mat2(u.t,-u.p,u.p,u.t);"
"vec3 o=e-q(),e=normalize(vec3(o.s,a*o.tp));"
"float c=e.t*.5+.5,l=(atan(e.p,e.s)+3.14159)/((3.141593)*2.),f=dot(normalize(o),d);"
"vec3 v=texture(k,vec2(l,c)).stp-.5;"
"t=vec4((texture(J,vec2(c,.0)+v.st*.01).stp+v.p*.01)*f,1.);"
"break;"
"}"
"if(!p)"
"{"
"float f=m(e);"
"l=min(f,a);"
"if(f<.0)"
"{"
"vec3 t=y(o,e);"
"float e=(1.-abs(dot(v,u)))/444.+length(t-s[0])/2222220.;"
"vec4 o=textureGrad(U,vec2((length(t-q())-h)/(P-h),.0),vec2(e),vec2(e));"
"float v=S(t);"
"o.stp*=1.-v,c=o*(1.-c.q)+c,p=true;"
"}"
"}"
"o=e,f=l,e+=v*(abs(l)+z);"
"}"
"if(t.q>=1.)"
"{"
"float o=S(e);"
"t.stp*=1.-o;"
"}"
"}"
"else"
"{"
"float o=smoothstep(A,w,l);"
"t.stp=mix(t.stp,mix(vec3(B(t.stp)),vec3(.1),pow(o*.98,9.)),o);"
"if(t.q>=1.)"
"{"
"float c=U0(e);"
"t.stp*=1.-c*(1.-o);"
"}"
"}"
"o=t*(1.-c.q)+c;"
"}"
#endif
"";
